# drone_builder

Применил метод Ziegler–Nichols для поиска подходящих коэф-тов ПИД регулятора. По итогу они изначально выдавали сильный скачки и мне пришлось самостоятельно докручивать их, хотя у парня, который делал симуляцию ракеты, у него все сразу получилось. Ладно, пускай так пока будет. Главное, что у меня есть более менее рабочие коэф-ты и это уже хорошо. 

Полученный график с новыми коэф-тами: 

<img width="612" height="473" alt="image" src="https://github.com/user-attachments/assets/6feaef34-df6c-4ee2-aab6-52769e9e2b63" />

YOLO11s + finetuning:

Использовал обученную нейросеть YOLO11S с весами датасета COCO и дообучил ее на 400 изображениях пластиковых бутылок в воде

Гиперапараметры
Размер изображений: 640х640
Разделение датасета: 320 тренировочные, 40 валидационные, 40 тестовые
Кол-во эпох: 60

Результаты:

-при confidence = 0.557 F1 равен 1, все обьекты предсказаны верно, в дальнейшем именно такой confidence и будет использоваться (box_f1_test)
-на валидационных изображениях точность mAp50 = 0.9874, mAp50-95 = 0.8057 (validation_results)
-на тестовых данных точность очень близка к валидационным, mAp50 =  0.995, mAp50-95 = 0.797, следовательно переобучения нет (test_results)
-

Введение:
Данная работа представляет испытательный стенд для одной оси У на двух моторах, гироскопе и микроконтроллере Ардуино. Он был создан как упрощение исытательного стенда для дрона с одной осью У и 4 моторами, так оба стенда имеют отличие лишь в количестве моторов, однако принцип работы, настройка регуляторов, а также фильтрация углов никак не меняется. 

Цель:
Составить и настроить перый блок стабилизации дрона на стенде из одной оси У. 

Задачи:
-собрать рабочий стенд для оси У на двух моторах из подручных материалов
-изучить и написать программное обеспечение для стенда
-настроить коэф-ты ПИД регулятора 

Строение:

<img width="677" height="741" alt="image" src="https://github.com/user-attachments/assets/346de11d-29aa-4165-8a31-26e50537dfae" />

Список оборудования:

-Arduino микроконтроллер
-ESC 40А регулятор мотора (2 штуки)
-мотор A2212 930KV (2 штуки)
-пропеллеры 1060 (2 штуки)
-гироскоп + акселерометр MPU6050
-аккумулятор TDB 11.1V 2.2Ah

Принцип работы:

1.Калибровка
  -ESC: калибруем max и min точки газа.
  -Гироскоп: расчитываем среднее смещение осей X/Y/Z от нуля и вычитаем его из следующих измерений.

2.Сбор данных
  С модуля MPU5050 каждые 4мс (250Гц) угловую скорость (гироскоп) по оси Y и ускорение (акселерометр) по всем трем осям. 

3. Фильтр Калмана
  Обьединяет углы из гироскопа и акселерометра. На выходе выдает отфильтрованный угол, который устойчив к вибрациям и смещению.

4. Внешний ПИД регулятор
  На входе сравнивает заданный угол с отфильтрованным углом. На выходе получаем угловую скорость, чтобы дрон вернулся в свое изначально положение.

5.Внутренний ПИД регулятор
  На входе получает угловую скорость из внешнего регулятора. Благодаря нему дрон возвращается в свое изначальное положение без колебаний, рывков и инерций моторов. 

Примечания:
-постоянная тяга моторов Current = 1400
-оба мотора вращаются в одну и ту же сторону (желательно в противоположные)
-min и max ограничение тяги моторов находится в диапазоне 1100-1800
-гироскоп на стенде стоит лицом вниз, знак осей Y и Z инвертированы
-корректировка тяги моторов InputPitch ограничено в диапазоне -400....+400

Результат работы:

Практическим опытом были получены следующие пид коэф-ты:

Внешний ПИД:
 PAnglePitch=0.15;
 IAnglePitch=0.0;
 DAnglePitch=0.0;

Внутренний ПИД:
 PRatePitch=0.6;
 IRatePitch=1.0;
 DRatePitch=0.03;

-первые 8 секунд после запуска, стенд самостоятельно держит баланс в диапазоне -5...+5 градусов (рис. 1). 
-при внешних толчках (с 8 по 15 секунду) стенд с затухающими колебаниями и небольшой резкостью возваращется обратно к 0 углу, необходимо увеличить DRatePitch. (рис. 1).
-при наклоне стенд в течение 3-5 секунд самостоятельно возвращется в положение 0 угла (рис. 1).
-с 20-25 секунду стенд стабилизировался, однако есть ошибка в райноне -3 градусов до 0, необходимо увеличить  IRatePitch (рис. 1).
-при толчках и наклонах угловая скорость RatePitch может достигать значений -80....+80, но они быстро затухают, внутренние ПИД коэффициенты подобраны точно (рис. 2). 
-моторы Left_throttle&Right_throttle, а также выходное значение внутреннего ПИД регулятора InputPitch редко достигают предела, что дает возможность настроить ПИД коэффициенты более точно (рис. 3, рис. 4).


<img width="1246" height="695" alt="angle_vs_time (1)" src="https://github.com/user-attachments/assets/d0413b38-e2bf-4b0d-b310-ad743f1a3f9e" />
рис. 1

<img width="1246" height="695" alt="rate_vs_time (1)" src="https://github.com/user-attachments/assets/f792aea4-62cb-43f7-ad56-347dde5b02a1" />
рис. 2

<img width="1258" height="695" alt="throttles_vs_time" src="https://github.com/user-attachments/assets/ae24c4aa-2f67-457f-a163-b7cf282f60df" />
рис. 3

<img width="1263" height="695" alt="input_vs_time" src="https://github.com/user-attachments/assets/9c4c229d-f918-4a3e-be73-6c3eb089c9a1" />
рис.4

Ссылка на видео:


Улучшения и следующие этапы:

-собрать стенд для одной оси Y  на 4 моторах для получения ПИД коэфициентов для реального полета
-собрать навесной стенд для получения ПИД коэффициентов для рыскания.
-добавить блок второго фильтра Калмана и третьего пид регулятора для получения точной высоты от модуля барометра BMP280 и акселерометра MPU6050
-собрать вертикальный стенд для испытания нового программного блока и получения ПИД коэффициентов для высоты
-поднять дрон в воздух и провести финальную настройку программного обеспечения. 
